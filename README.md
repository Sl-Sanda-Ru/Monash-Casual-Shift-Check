# Monash-Casual-Shift-Check

[![CodeFactor](https://www.codefactor.io/repository/github/sl-sanda-ru/monash-casual-shift-check/badge)](https://www.codefactor.io/repository/github/sl-sanda-ru/monash-casual-shift-check)
[![wakatime](https://wakatime.com/badge/user/018e35c7-dffb-4eaa-b21c-9bb81183371b/project/33329252-3480-4118-990e-266d11a9f56d.svg)](https://wakatime.com/badge/user/018e35c7-dffb-4eaa-b21c-9bb81183371b/project/33329252-3480-4118-990e-266d11a9f56d)

Monash-Casual-Shift-Check is a Python script designed to fetch and process shift rosters, calculate completed hours, and send notifications via Telegram. This script uses various libraries including `requests`, `selenium`, and `pyrogram` to automate the process and keep track of your working hours efficiently. It can run seamlessly on a local machine or a virtual server.

## Backstory

As an international student in Australia, I am only allowed to work 48 hours per fortnight. Keeping track of my completed hours and upcoming shifts has been a constant hassle. To make this process easier and avoid any potential issues with exceeding my allowed working hours, I developed Monash-Casual-Shift-Check.

## Features

- üóÇÔ∏è **Fetch Roster Data:** Retrieves shift rosters from the provided API.
- ‚è∞ **Calculate Shift Hours:** Computes the duration of each shift.
- üìä **Process Roster Data:** Organizes shift information and calculates total hours.
- üïí **Track Completed Hours:** Logs into the Kronos platform and fetches the total completed hours.
- üì¨ **Send Notifications:** Uses a Telegram bot to send daily updates on completed hours and future bookings.
- üåê **Virtual Server Compatible:** Can be run on a virtual server for continuous operation.

## Requirements

- Python 3.7+
- `requests`
- `selenium`
- `webdriver-manager`
- `schedule`
- `pyrogram`
- `python-dotenv`

## Setup

1. **Clone the repository:**
   ```bash
   git clone https://github.com/Sl-Sanda-Ru/Monash-Casual-Shift-Check.git
   cd Monash-Casual-Shift-Check
   ```

2. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Configuration:**
   - Create a `config.env` file in the root directory and add the following variables:
     ```
     BTTKN=<Your Telegram Bot Token>
     APIID=<Your Telegram API ID>
     APIHASH=<Your Telegram API Hash>
     AUTHKEY=<Your Authorization Key>
     UNAME=<Your Kronos Username>
     PWORD=<Your Kronos Password>
     TIME=<Time to run the script (e.g., '08:00')>
     ```

## Usage

1. **Run the script:**
   ```bash
   python runner.py
   ```

2. **Stop the script:** Use `Ctrl+C` to terminate the script manually.

## How It Works

1. **Initialize WebDriver and Telegram Bot:**
   - Sets up a headless Chrome WebDriver instance.
   - Initializes the Telegram bot client using `pyrogram`.

2. **Fetch and Process Roster Data:**
   - Sends a GET request to the roster API.
   - Processes the received JSON data to extract shifts and calculate total hours.

3. **Track Completed Hours:**
   - Logs into the Kronos platform using Selenium.
   - Navigates to the timecard page and retrieves the total hours worked.

4. **Send Notifications:**
   - Combines the completed hours with future bookings.
   - Sends a formatted message to the specified Telegram chat ID with the daily report.

5. **Schedule the Task:**
   - Uses `schedule` to run the script at a specified time every day.

## Running on a Virtual Server

To run Monash-Casual-Shift-Check on a virtual server, follow these additional steps:

1. **Set up the virtual server:**
   - Ensure the server has Python 3.7+ installed.
   - Install the necessary dependencies using the provided `requirements.txt` file.

2. **Run the script in the background using `tmux`:**

   **Install `tmux` if it's not already installed:**
   ```bash
   sudo apt-get install tmux
   ```

   **Start a new `tmux` session:**
   ```bash
   tmux new -s notify-bot
   ```

   **Run the script within the `tmux` session:**
   ```bash
   python runner.py
   ```

   **Detach from the `tmux` session:**
   ```bash
   Ctrl+b then d
   ```

   **To reattach to the `tmux` session later:**
   ```bash
   tmux attach -t notify-bot
   ```
## Result
<img src="https://github.com/Sl-Sanda-Ru/Monash-Casual-Shift-Check/assets/68476573/99cf3542-7121-45c2-acc7-4dc29f6a0140" width="270" height="720">


## Logging

The script uses Python's `logging` module to log important events and errors.


## Contributing

Contributions are welcome! Please open an issue or submit a pull request for any improvements or bug fixes.

***This README was generated by ChatGPT*** <img src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/chatgpt-icon.svg" width="50" height="50">
